/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.0/userguide/java_library_plugin.html
 */

plugins {
    // Apply the java-library plugin to add support for Java Library
    id 'java'
    id 'org.springframework.boot' version '2.7.0'
    id 'io.spring.dependency-management' version '1.0.11.RELEASE'
    id 'io.freefair.lombok' version '6.1.0-m1'
    id 'signing'
    id 'maven-publish'
    id "org.owasp.dependencycheck" version "6.4.1.1"
    id 'jacoco'
}

group = 'com.siliconmtn'
version = '0.1.6-SNAPSHOT'
sourceCompatibility = '11'
archivesBaseName = "nga-oe-java"

repositories {
    // Use jcenter for resolving dependencies.
    // You can declare any Maven/Ivy/file repository here.
    mavenCentral()
    maven {
        url 'https://oss.sonatype.org/content/repositories/snapshots/'
    }
}

dependencies {
    // This dependency is used internally, and not exposed to consumers on their own compile classpath.
    implementation 'commons-beanutils:commons-beanutils:1.9.4'
    implementation 'commons-io:commons-io:2.8.0'
    implementation 'com.googlecode.libphonenumber:libphonenumber:8.12.16'
	implementation 'org.apache.logging.log4j:log4j-api:2.14.0'
	implementation 'org.apache.logging.log4j:log4j-core:2.14.0'
	implementation 'com.fasterxml.jackson.datatype:jackson-datatype-jsr310:2.12.3'
	
	// Spring Boot (Starters -> https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#using-boot-starter)
	implementation 'org.springframework.boot:spring-boot-starter'
	implementation 'org.springframework.boot:spring-boot-starter-web'
	implementation 'org.springframework.boot:spring-boot-starter-data-jpa'
	implementation 'org.springframework.boot:spring-boot-starter-aop'
	implementation 'org.springframework.boot:spring-boot-starter-validation'
	implementation 'org.springframework.security:spring-security-crypto:5.5.2'
	implementation 'org.hibernate:hibernate-validator:7.0.1.Final'
	
	// XSS content validation/filtering
	implementation 'org.owasp.encoder:encoder:1.2.3'
	implementation 'org.jsoup:jsoup:1.14.2'
	implementation 'com.auth0:java-jwt:3.14.0'
	
	// https://mvnrepository.com/artifact/com.networknt/json-schema-validator
	implementation 'com.networknt:json-schema-validator:1.0.72'
	
    // Testing
    testImplementation 'org.springframework.security:spring-security-test'
    testImplementation 'org.mockito:mockito-core:3.10.0'
	testImplementation 'org.mockito:mockito-inline:3.10.0'
	testImplementation('org.springframework.boot:spring-boot-starter-test'){
		exclude group: 'org.junit.vintage', module: 'junit-vintage-engine'
	}

	// https://mvnrepository.com/artifact/org.apache.pulsar/pulsar-client
	implementation 'org.apache.pulsar:pulsar-client:2.10.1'

	// GSON Import
	implementation 'com.google.code.gson:gson:2.9.1'

	// Space Libs Import
	implementation 'com.siliconmtn:spacelibs-java:1.2.5-SNAPSHOT'

}

// Prevent Spring Boot from looking for a main()
bootJar {
	enabled = false
}
jar {
	enabled = true
}

test {
    finalizedBy jacocoTestReport // report is always generated after tests run
    useJUnitPlatform()
}

jacocoTestReport {
	reports {
        xml.required = true
        csv.required = false
        html.required = true
	}
	dependsOn test
}

// Set the source path to the delombok source so the javadocs will be built properly
javadoc {
	source = delombok.sourcepath
	javadoc.options.addStringOption('Xdoclint:all', '-quiet')
	options.tags = ["updates", "updates:"]
}

java {
    withJavadocJar()
    withSourcesJar()
}
publishing {
	publications {
		ngaOeJava(MavenPublication) {
			artifactId = 'nga-oe-java'
      		from components.java
      		versionMapping {
      			usage('java-api') {
      				fromResolutionOf('runtimeClasspath')
		        }
		        usage('java-runtime') {
		        	fromResolutionResult()
		        }
		    }
			pom {
				name = "nga-oe-java"
			    description = "A libary of useful tools and helper objects."
			    url = "https://github.com/smtadmin/nga-oe-java"
			    licenses {
			    	license {
			        	name = "MIT License"
			            url = "https://opensource.org/licenses/mit-license.php"
			        }
			    }
			    developers {
			    	developer {
			        	id = "etewa"
			        	name = "James Camire"
			        	email = "james@siliconmtn.com"
			        	organization = "Silicon Mountain Technologies, Inc."
			        	organizationUrl = "https://www.siliconmtn.com"
			        }
			    }
			    scm {
			    	connection = "scm:git:git://github.com/smtadmin/nga-oe-java.git"
			    	developerConnection = "scm:git:ssh://github.com:smtadmin/nga-oe-java.git"
			    	url = "https://github.com/smtadmin/nga-oe-java/tree/main"
			    }
			}
		}
	}
	repositories {
		if (project.version.endsWith("-SNAPSHOT")){
			maven {
				credentials {
					username project.ossrhUsername
					password project.ossrhPassword
				}
            	url = "https://oss.sonatype.org/content/repositories/snapshots/"
            }
        }
        else {
        	maven {
        		url = "$buildDir/repos/releases"
        	}
        }
    }
}

signing {
    sign publishing.publications.ngaOeJava
}

